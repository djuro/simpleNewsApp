<?php

/**
 * UsersTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class UsersTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object UsersTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Users');
    }
    
    
    /**
     *  'Selecta' korisnika na osnovu username-a i vraca objekt ako taj user postoji 
     */
    public function verifyUser($username,$password)
    {
     $user_result = $this->createQuery("usr")
                 ->select("usr.username,usr.name,usr.surname,usr.password,usr.id,r.name")
                 ->innerJoin("usr.Roles r")
				 ->where("usr.username=?",$username)
                 ->fetchOne();

     if (is_object($user_result)) 
     {
      $usrnm = $user_result->getUsername();
      if(!empty($usrnm))
       {
        if(sha1($password)==$user_result->getPassword())
         {
          
          return array(
                       true,
                       $usrnm,
                       $user_result->getId(),
                       $user_result->getRoles()->getName(),
                       $user_result->getName(),
                       $user_result->getSurname(),
                       $user_result->getNickname(),
                      );
          
         }
        else
         {
          return array(false,false,false,false);
         }
       }
      else
       {
        return array(false,false,false,false);
       }    
     }
   
    }
    
    
    /**
     * 'Slaze' random password od slucajnih brojeva, za novog anonimnog korisnika 
     * 
     */
    public function createPassword()
    {
     $brojA = rand(0,1000);
     $brojB = rand(0,1000);
     
     $passwd = $brojA.$brojB;
     return $passwd;
    }
}